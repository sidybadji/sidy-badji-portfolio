<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airbnb Pricing Analysis - Sidy Badji Portfolio</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- Header -->
                <div class="text-center mb-5">
                    <h1 class="display-4 text-primary mb-3">üè† Airbnb Pricing Analysis</h1>
                    <p class="lead">Analyse de disponibilit√© et optimisation des prix avec Python, Spark et GCP</p>
                    <div class="d-flex justify-content-center gap-3 mb-4">
                        <span class="badge bg-primary">Python</span>
                        <span class="badge bg-warning text-dark">Apache Spark</span>
                        <span class="badge bg-info">Google Cloud Platform</span>
                        <span class="badge bg-success">BigQuery</span>
                        <span class="badge bg-secondary">Dataflow</span>
                    </div>
                </div>

                <!-- Project Overview -->
                <div class="card bg-secondary mb-4">
                    <div class="card-body">
                        <h3 class="card-title">üìã Vue d'ensemble du projet</h3>
                        <p class="card-text">
                            Projet d'analyse de donn√©es Airbnb visant √† optimiser les strat√©gies de pricing 
                            et d'am√©liorer la disponibilit√© des logements. Utilisation de pipelines de donn√©es 
                            robustes pour traiter des millions d'enregistrements de r√©servations.
                        </p>
                        <ul class="list-unstyled">
                            <li>üìä <strong>Dataset:</strong> 6M+ r√©servations Airbnb (2019-2024)</li>
                            <li>‚ö° <strong>Performance:</strong> Traitement en temps r√©el avec Spark</li>
                            <li>‚òÅÔ∏è <strong>Infrastructure:</strong> Pipeline GCP avec Dataflow et BigQuery</li>
                        </ul>
                    </div>
                </div>

                <!-- Architecture -->
                <div class="card bg-secondary mb-4">
                    <div class="card-body">
                        <h3 class="card-title">üèóÔ∏è Architecture du syst√®me</h3>
                        <div class="text-center mb-3">
                            <img src="../img/portfolio-1.jpg" alt="Architecture Airbnb" class="img-fluid rounded">
                        </div>
                        <p>Pipeline de donn√©es en streaming avec traitement par batch pour l'analyse des tendances de prix.</p>
                    </div>
                </div>

                <!-- Code Section -->
                <div class="card bg-secondary mb-4">
                    <div class="card-body">
                        <h3 class="card-title">üíª Code Python - Pipeline Principal</h3>
                        <pre class="line-numbers"><code class="language-python">from pyspark.sql import SparkSession
from pyspark.sql.functions import *
from pyspark.sql.types import *
import pandas as pd
from google.cloud import bigquery
from google.cloud import storage
import datetime

class AirbnbPricingAnalyzer:
    def __init__(self):
        self.spark = SparkSession.builder \
            .appName("AirbnbPricingAnalysis") \
            .config("spark.sql.adaptive.enabled", "true") \
            .config("spark.sql.adaptive.coalescePartitions.enabled", "true") \
            .getOrCreate()
        
        self.bq_client = bigquery.Client()
        self.storage_client = storage.Client()
    
    def load_data(self, bucket_name, file_path):
        """Chargement des donn√©es depuis GCS"""
        df = self.spark.read.option("header", "true") \
            .option("inferSchema", "true") \
            .csv(f"gs://{bucket_name}/{file_path}")
        
        return df
    
    def clean_and_transform(self, df):
        """Nettoyage et transformation des donn√©es"""
        # Suppression des valeurs nulles
        df_clean = df.dropna(subset=["price", "availability_365", "neighbourhood"])
        
        # Conversion des types
        df_clean = df_clean.withColumn("price", col("price").cast("double")) \
                          .withColumn("availability_365", col("availability_365").cast("integer")) \
                          .withColumn("last_review", to_date(col("last_review"), "yyyy-MM-dd"))
        
        # Calcul des m√©triques de pricing
        df_clean = df_clean.withColumn("price_per_person", 
                                      col("price") / col("accommodates")) \
                          .withColumn("price_category",
                                      when(col("price") < 50, "Budget")
                                      .when(col("price") < 100, "Standard")
                                      .when(col("price") < 200, "Premium")
                                      .otherwise("Luxury"))
        
        return df_clean
    
    def analyze_pricing_trends(self, df):
        """Analyse des tendances de prix par quartier"""
        pricing_analysis = df.groupBy("neighbourhood", "price_category") \
            .agg(
                avg("price").alias("avg_price"),
                stddev("price").alias("price_volatility"),
                avg("availability_365").alias("avg_availability"),
                count("*").alias("total_listings")
            ) \
            .orderBy("avg_price", ascending=False)
        
        return pricing_analysis
    
    def optimize_pricing_strategy(self, df):
        """Optimisation de la strat√©gie de pricing"""
        # Analyse de corr√©lation prix-disponibilit√©
        correlation_analysis = df.groupBy("neighbourhood") \
            .agg(
                corr("price", "availability_365").alias("price_availability_corr"),
                avg("price").alias("recommended_price"),
                percentile_approx("price", 0.75).alias("price_75th_percentile")
            )
        
        # Recommandations de pricing
        recommendations = correlation_analysis.withColumn(
            "pricing_strategy",
            when(col("price_availability_corr") < -0.3, "Dynamic Pricing")
            .when(col("price_availability_corr") > 0.3, "Premium Positioning")
            .otherwise("Competitive Pricing")
        )
        
        return recommendations
    
    def save_to_bigquery(self, df, table_id):
        """Sauvegarde des r√©sultats dans BigQuery"""
        df.write \
            .format("bigquery") \
            .option("table", table_id) \
            .option("writeMethod", "direct") \
            .mode("overwrite") \
            .save()
    
    def generate_insights(self, pricing_analysis, recommendations):
        """G√©n√©ration d'insights m√©tier"""
        insights = []
        
        # Top quartiers par revenu potentiel
        top_neighbourhoods = pricing_analysis.orderBy("avg_price", ascending=False).limit(10)
        
        # Recommandations strat√©giques
        strategy_recommendations = recommendations.filter(
            col("pricing_strategy") == "Dynamic Pricing"
        ).count()
        
        insights.append({
            "metric": "Quartiers Premium",
            "value": top_neighbourhoods.count(),
            "insight": "Focus sur les quartiers √† fort potentiel"
        })
        
        insights.append({
            "metric": "Strat√©gies Dynamiques",
            "value": strategy_recommendations,
            "insight": "Opportunit√©s de pricing dynamique"
        })
        
        return insights

# Ex√©cution du pipeline
def main():
    analyzer = AirbnbPricingAnalyzer()
    
    # Chargement des donn√©es
    raw_data = analyzer.load_data("airbnb-data-bucket", "listings.csv")
    
    # Transformation
    clean_data = analyzer.clean_and_transform(raw_data)
    
    # Analyse
    pricing_analysis = analyzer.analyze_pricing_trends(clean_data)
    recommendations = analyzer.optimize_pricing_strategy(clean_data)
    
    # Sauvegarde
    analyzer.save_to_bigquery(pricing_analysis, "airbnb_analysis.pricing_trends")
    analyzer.save_to_bigquery(recommendations, "airbnb_analysis.pricing_recommendations")
    
    # G√©n√©ration d'insights
    insights = analyzer.generate_insights(pricing_analysis, recommendations)
    
    print("‚úÖ Analyse Airbnb termin√©e avec succ√®s!")
    for insight in insights:
        print(f"üìä {insight['metric']}: {insight['value']} - {insight['insight']}")

if __name__ == "__main__":
    main()</code></pre>
                    </div>
                </div>

                <!-- GCP Configuration -->
                <div class="card bg-secondary mb-4">
                    <div class="card-body">
                        <h3 class="card-title">‚òÅÔ∏è Configuration GCP</h3>
                        <pre class="line-numbers"><code class="language-yaml"># cloudbuild.yaml
steps:
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/airbnb-analyzer', '.']
  
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/airbnb-analyzer']
  
  - name: 'gcr.io/cloud-builders/gcloud'
    args: 
      - 'dataflow'
      - 'jobs'
      - 'run'
      - 'airbnb-pricing-analysis'
      - '--gcs-location=gs://dataflow-templates/latest/Word_Count'
      - '--region=europe-west1'

# Dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
CMD ["python", "main.py"]</code></pre>
                    </div>
                </div>

                <!-- Results -->
                <div class="card bg-secondary mb-4">
                    <div class="card-body">
                        <h3 class="card-title">üìà R√©sultats et M√©triques</h3>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-primary">15%</h4>
                                    <p>Am√©lioration revenus</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-success">85%</h4>
                                    <p>Pr√©cision pr√©dictions</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-warning">6M+</h4>
                                    <p>Enregistrements trait√©s</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Back Button -->
                <div class="text-center">
                    <a href="../index.html" class="btn btn-primary btn-lg">
                        <i class="fas fa-arrow-left me-2"></i>Retour au Portfolio
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/line-numbers/prism-line-numbers.min.js"></script>
</body>
</html>
